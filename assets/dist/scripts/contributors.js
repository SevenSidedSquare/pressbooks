jQuery((function(e){var t=function(e,t){var i=jQuery(e);i.attr("aria-describedby",t),i.parent().find("p").attr("id",t)},i=parseInt(pictureSize.min),r=jQuery("#contributor-picture"),a=jQuery("#contributor-picture-thumbnail");jQuery("#slug").attr("readonly",!0),t("#tag-name","name-description"),t("#name","name-description"),t("#tag-slug","slug-description"),t("#slug","slug-description"),t("#btn-media","media-description");var n=function(e,t){var r,a,n,o,s,d,u,c,l,p=e.get("width"),g=e.get("height"),m=i,h=i,y=m,v=h,w=2*i;t.set("canSkipCrop",(s=!1,d=m,u=h,c=p,l=g,!!(!0==(o=!1)&&!0===s||!0===o&&u===l||!0===s&&d===c||d===c&&u===l||c<=d))),p/g>1?m=1*(h=g>w?w:g):h=(m=p>w?w:p)/1,r=(p-m)/2,a=(g-h)/2;var b=g>i||p>i;return n={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:p,imageHeight:g,minWidth:y>m?m:y,minHeight:v>h?h:v,x1:b?r-1:r,y1:b?a-1:a,x2:b?m+r-1:m+r,y2:b?h+a-1:h+a},n.aspectRatio=m+":"+h,n};jQuery(document).ajaxComplete((function(e,t,i){i.data.indexOf("action=add-tag")>=0&&(window.tinyMCE.activeEditor.setContent(""),a.attr("src","").hide(),r.val(""))})),jQuery(document).ajaxSend((function(e,t,i){if(i.data.indexOf("action=add-tag")>=0){window.tinyMCE.triggerSave();var r=new URLSearchParams(i.data);r.set("contributor_description",window.tinyMCE.activeEditor.getContent()),i.data=r.toString()}})),jQuery(".term-description-wrap").remove(),jQuery("#contributor-media-picture").hide(),jQuery("#wpbody-content > div.wrap.nosubsub > form").css("margin",0),jQuery("#btn-media").on("click",(function(e){e.preventDefault(),jQuery("#plupload-browse-button").click()})),jQuery("#plupload-browse-button").on("click",(function(e){var t=wp.media.controller.CustomizeImageCropper.extend({doCrop:function(e){var t=e.get("cropDetails"),r=parseInt(i);return t.dst_width=r,t.dst_height=r,wp.ajax.post("crop-image",{nonce:e.get("nonces").edit,id:e.get("id"),cropDetails:t})}}),o=wp.media({button:{text:"Done",close:!1},states:[new wp.media.controller.Library({title:"Select a picture",library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:i,suggestedHeight:i}),new t({imgSelectOptions:n})]});e.preventDefault(),o.open(),o.on("cropped",(function(e){r.val(e.url),a.attr("src",e.url).show()})),o.on("insert",(function(){var e=o.state().get("selection").first().toJSON();r.val(e.url),a.attr("src",e.url).show()})),o.on("select",(function(){var e=o.state().get("selection").first().toJSON();if(e.width<i||e.height<i){var t='<div class="media-uploader-status errors"><div class="upload-errors"><div class="upload-error">\n<span class="upload-error-filename">Your image is too small.</span><span class="upload-error-message">The image must be '+i+" by "+i+" pixels. Your image is "+e.width+" by "+e.height+" pixels.</span></div></div></div>";jQuery(".media-sidebar").html(t)}else e.width!==i||e.height!==i?o.setState("cropper"):(r.val(e.url),a.attr("src",e.url).show(),o.close())}))}))}));